
// For format details, see https://aka.ms/devcontainer.json. For config options, see the README at:
// https://github.com/devcontainers/images/tree/main/src/python
{
	"name": "Python",

	"build": {
        "dockerfile": "./Dockerfile",
        "context": "."
    },

    "features": {
        "ghcr.io/devcontainers/features/common-utils:2":{
            "installZsh": "true",
            "username": "vscode",
            "userUid": "1000",
            "userGid": "1000",
            "upgradePackages": "true"
        },
        "ghcr.io/devcontainers/features/python:1": "none",
        "ghcr.io/devcontainers/features/node:1": "none",
        "ghcr.io/devcontainers/features/git:1": {
            "version": "latest",
            "ppa": "false"
        },
        "ghcr.io/devcontainers/features/docker-in-docker:2": {
            "version": "latest"
        }
    },

    // Configure tool-specific properties.
	"customizations": {
		// Configure properties specific to VS Code.
		"vscode": {
			// Set *default* container specific settings.json values on container create.
			"settings": {
				"python.defaultInterpreterPath": "/usr/local/bin/python",
                "python.editor.defaultFormatter": "ms-python.black-formatter",
                "editor.formatOnSave": true,
                "python.linting.enabled": true,
                "python.linting.flake8Enabled": true,
                "python.testing.pytestEnabled":true,
                "python.editor.codeActionsOnSave": {
                    "source.organizeImports": true
                }
			},
            "extensions": [
                "sonarsource.sonarlint-vscode",
                "ms-python.black-formatter",
                "ms-python.python",
		        "ms-python.isort",
                "ms-python.mypy-type-checker",
                "donjayamanne.python-extension-pack",
                "ms-azuretools.vscode-docker"
            ]
		}
	},

    "workspaceFolder": "/workspace",

	// Use 'forwardPorts' to make a list of ports inside the container available locally.
	// "forwardPorts": [],

	// Comment out connect as root instead. More info: https://aka.ms/vscode-remote/containers/non-root.
	"remoteUser": "vscode",

    // Use 'postCreateCommand' to run commands after the container is created.
	"postCreateCommand": {
        "enable_husky": "npx husky install < /dev/null",
        "add_pre_commit_hook": "npx husky add .husky/commit-msg 'npx --no-install commitlint --edit $1'",
        "update_python_modules": "pip --no-cache-dir install -r /workspace/src/python_app/requirements-dev.txt"
    }
}